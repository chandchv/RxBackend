{% extends 'base.html' %}

{% block content %}
<h1>Patient Form</h1>
<div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold mb-6 text-center">Patient entry form</h2>
    <form id="patient-form" 
          hx-post="{% url 'users:create_patient' %}" 
          hx-target="#form-response"
          hx-swap="innerHTML"
          class="space-y-4">
        {% csrf_token %}
        <div class="space-y-4">
            <div>
                
                <label class="block text-gray-700 text-sm font-bold mb-2" for="patient_id">Patient ID</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="patient_id" type="text" name="patient_id" required>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="first_name">First Name</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="first_name" type="text" name="first_name" required>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="last_name">Last Name</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="last_name" type="text" name="last_name" required>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="date_of_birth">Date of Birth</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="date_of_birth" type="date" name="date_of_birth" required>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="gender">Gender</label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="gender" name="gender" required>
                    <option value="">Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="others">Others</option>
                </select>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="phone_number">Phone Number</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                    id="phone_number" 
                    type="tel" 
                    name="phone_number" 
                    pattern="[0-9]{10}"
                    oninput="validatePhone(this)"
                    required>
                <span id="phone-error" class="text-red-500 text-sm hidden">Please enter a valid 10-digit phone number</span>

                <label class="block text-gray-700 text-sm font-bold mb-2" for="email">Email</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                    id="email" 
                    type="email" 
                    name="email" 
                    oninput="validateEmail(this)"
                    required>
                <span id="email-error" class="text-red-500 text-sm hidden">Please enter a valid email address</span>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="address">Address</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="address" type="text" name="address" required>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="pincode">Pincode</label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="pincode" type="text" name="pincode" required>

            </div>
        </div>
        <div class="mt-4">
            <button type="submit" 
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Add Patient
            </button>
        </div>
    </form>
    <div id="form-response"></div>
</div>
{% endblock %}  

{% block extra_scripts %}
<script>
    function validateEmail(input) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const errorSpan = document.getElementById('email-error');
        
        if (!emailRegex.test(input.value)) {
            errorSpan.classList.remove('hidden');
            input.classList.add('border-red-500');
            return false;
        } else {
            errorSpan.classList.add('hidden');
            input.classList.remove('border-red-500');
            return true;
        }
    }

    function validatePhone(input) {
        const phoneRegex = /^[0-9]{10}$/;
        const errorSpan = document.getElementById('phone-error');
        
        if (!phoneRegex.test(input.value)) {
            errorSpan.classList.remove('hidden');
            input.classList.add('border-red-500');
            return false;
        } else {
            errorSpan.classList.add('hidden');
            input.classList.remove('border-red-500');
            return true;
        }
    }

    // Add form submission validation
    document.getElementById('patient-form').addEventListener('submit', function(event) {
        const email = document.getElementById('email');
        const phone = document.getElementById('phone_number');
        
        const isEmailValid = validateEmail(email);
        const isPhoneValid = validatePhone(phone);
        
        if (!isEmailValid || !isPhoneValid) {
            event.preventDefault();
        }
    });
</script>
{% endblock %}  


